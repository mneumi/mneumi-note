## Docker自身命令

| 命令               | 说明                                                 |
| ------------------ | ---------------------------------------------------- |
| docker version     | 查看docker的版本                                     |
| docker info        | 显示docker的系统信息，更加详细，包括镜像和容器的数量 |
| docker 命令 --help | 命令的使用帮助信息                                   |



## Docker镜像命令

### 拉取镜像[增]

| 命令                      | 说明                               |
| ------------------------- | ---------------------------------- |
| docker pull 镜像名:版本号 | 拉取镜像，版本号省略时为 `lastest` |

### 删除镜像[删]

| 命令                               | 说明                                             |
| ---------------------------------- | ------------------------------------------------ |
| docker rmi 镜像名:版本号           | 根据镜像名删除镜像，版本号省略时为 `lastest`     |
| docker rmi 镜像ID                  | 根据镜像ID删除镜像                               |
| docker rmi -f $(docker images -aq) | 组合命令，获取所有镜像ID，然后根据ID删除所有镜像 |

### 查询本地镜像[查]

| 命令                                 | 说明                               |
| ------------------------------------ | ---------------------------------- |
| docker images                        | 查看所有镜像信息列表               |
| docker images -a                     | 列出所有镜像                       |
| docker images -q                     | 查看所有镜像ID列表                 |
| docker search 镜像名:版本号          | 搜索镜像，版本号省略时为 `lastest` |
| docker inspect  镜像名:版本号/镜像ID | 查看镜像的详细信息                 |

### 搜索远程库镜像[查]

| 命令                                   | 说明                           |
| -------------------------------------- | ------------------------------ |
| docker search 镜像名                   | 用于在远程库中搜索相关的镜像   |
| docker search --filter=STARTS=n 镜像名 | 搜索出 STARS 大于等于 n 的镜像 |

### 镜像打标签

| 命令                                      | 说明         |
| ----------------------------------------- | ------------ |
| docker tag 镜像名称:版本号/镜像ID tag名称 | 给镜像打标签 |

### 提交镜像

| 命令                                                         | 说明                   |
| ------------------------------------------------------------ | ---------------------- |
| docker commit -m "描述信息" -a "作者" 容器id 目标镜像名:[TAG] | 提交容器为一个新的镜像 |

### 推送镜像

| 命令                      | 说明           |
| ------------------------- | -------------- |
| docker push 镜像名:版本号 | 推送镜像到仓库 |



## Docker容器命令

### 查看容器列表

| 命令              | 说明                                 |
| ----------------- | ------------------------------------ |
| docker ps         | 查看正在运行的容器                   |
| docker ps -a      | 查看所有容器，包括已经停止的容器     |
| docker ps -q      | 查看正在运行的容器的ID               |
| docker ps -a -q   | 查看所有容器的ID，包括已经停止的容器 |
| docker ps -n=数字 | 查看最近的n个容器                    |

### 创建并运行容器

```shell
docker run [参数列表] [初始化命令]
```

参数说明

| 参数列表  | 说明                                                         |
| --------- | ------------------------------------------------------------ |
| --name    | 指定容器名字，如果不指定将由系统随机生成                     |
| --restart | 重启策略，有下列值<br />no：默认策略，在容器退出时不重启容器<br />on-failure，在容器非正常退出时（退出状态非0），才会重启容器<br />on-failure:3，在容器非正常退出时重启容器，最多重启3次<br />always，在容器退出时总是重启容器<br />unless-stopped，容器退出时总是重启容器，但不考虑在Docker守护进程启动时就停止了的容器 |
| -i        | 保持容器运行                                                 |
| -t        | 以交互式创建容器                                             |
| -d        | 以守护进程形式创建容器                                       |
| -p        | 映射端口<br />方式1：-p ip:主机端口:容器端口（常用）<br />方式2：-p 主机端口:容器端口（常用）<br />方式3：-p 容器端口 |
| -P(大写)  | 随机指定端口                                                 |
| -v        | 设置数据卷                                                   |
| -e        | 指定环境变量                                                 |

执行流程：

* 先看本地有没有镜像，如果有则使用该镜像创建容器
* 如果没有，则去`Docker Hub`找
* 如果找到了，就下载镜像到本地，然后再使用镜像创建容器
* 如果找不到，就报错

### 运行容器

| 命令                              | 说明                                                         |
| --------------------------------- | ------------------------------------------------------------ |
| docker start 容器名:版本号/容器ID | `docker start`只能运行已经存在的容器，`docker run`能创建和运行容器，版本号省略时为 `lastest` |

### 停止容器

| 命令                             | 说明                     |
| -------------------------------- | ------------------------ |
| docker stop 容器名:版本号/容器ID | 版本号省略时为 `lastest` |
| docker kill 容器名:版本号/容器ID | 强制停止                 |

### 重启容器

| 命令                                | 说明 |
| ----------------------------------- | ---- |
| docker restart 容器名:版本号/容器ID |      |

### 删除容器

| 命令                             | 说明                               |
| -------------------------------- | ---------------------------------- |
| docker rm 容器名称:版本号/容器ID | 删除容器，版本号省略时为 `lastest` |
| docker rm -f $(docker ps -aq)    | 删除所有容器，-f表示强制删除       |

### 进入容器

| 命令                                               | 说明                                 |
| -------------------------------------------------- | ------------------------------------ |
| docker exec -it 容器名称:版本号/容器ID /bin/bash   | 进入正在运行的容器，会创建新的终端   |
| docker attach -it 容器名称:版本号/容器ID /bin/bash | 进入正在运行的容器，不会创建新的终端 |

### 退出容器

| 命令         | 说明                   |
| ------------ | ---------------------- |
| exit         | 直接退出并停止容器     |
| Ctrl + P + Q | 退出容器，但不停止容器 |

### 查看容器信息

| 命令                                  | 说明                     |
| ------------------------------------- | ------------------------ |
| docker inspect 容器名称:版本号/容器ID | 版本号省略时为 `lastest` |

### 查看容器中的进程信息

| 命令                              | 说明         |
| --------------------------------- | ------------ |
| docker top 容器名称:版本号/容器ID | 查看进程信息 |

### 查看日志

| 命令                                                 | 说明     |
| ---------------------------------------------------- | -------- |
| docker logs -f -t --tail 条数 容器名称:版本号/容器ID | 查看日志 |
| docker logs -ft 容器名称:版本号/容器ID               | 查看日志 |

### 拷贝操作

> 只要容器在，数据就在，copy与容器是否正在运行没有关系
>
> 拷贝是一个手动的过程，未来使用 -v 数据卷的技术，可以实现，自动同步

| 命令                                              | 说明             |
| ------------------------------------------------- | ---------------- |
| docker cp 容器名称/容器ID:容器内路径 本地主机路径 | 容器 => 本地主机 |
| docker cp 本地主机路径 容器名称/容器ID:容器内路径 | 本地主机 => 容器 |

### 容器打包命令

| 命令                                             | 说明                     |
| ------------------------------------------------ | ------------------------ |
| docker save -o 压缩文件名 容器名称:版本号/容器ID | 版本号省略时为 `lastest` |
| docker load -i 压缩文件名                        | 加载打包镜像             |



## 使用案例

### 案例1：Docker安装Nginx

1.搜索镜像

```shell
docker search nginx # 详细信息和具体版本要到 hub.docker.com查看
```

2.下载镜像

```shell
docker pull nginx
```

3.以后台方式启动Nginx（起名为 nginx01，指定端口为 主机3344，容器80）

```shell
docker run -d --name nginx01 -p 3344:80 nginx
```

4.查看容器运行列表

```shell
docker ps 
```

5.本机自测（检测是否成功）

```shell
curl localhost:3344
```

6.进入nginx容器内部

```shell
docker exec -it nginx /bin/bash
```

7.查看配置文件在哪

```shell
whereis nginx
```

8.配置文件

```shell
sudo vim /etc/nginx/nginx.conf
```

### 案例2：Docker 安装 tomcat

1.搜索镜像

```shell
docker search tomcat # 详细信息和具体版本要到 hub.docker.com查看
```

2.下载镜像

```shell
docker pull tomcat:latest
```

3.以后台方式启动tomcat（起名为 mytomcat，指定端口为 主机3355，容器8080）

```shell
docker run -d -p 3355:8080 --name mytomcat tomcat
```

4.查看容器运行列表

```shell
docker ps 
```

5.本机自测（检测是否成功）

```shell
curl localhost:3355
```

6.进入tomcat容器内部

```shell
docker exec mytomcat -it /bin/bash
```

