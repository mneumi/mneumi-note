## 命令行工具一览

| 命令       | 功能                                                 | 可选参数                                   |
| ---------- | ---------------------------------------------------- | ------------------------------------------ |
| go         | 查看go命令行工具的说明                               |                                            |
| go build   | 生成可执行二进制文件                                 | go build -o "name" 指定编译后的文件名字    |
| go clean   | go build后会残留一些临时文件，可以用go clean清除     |                                            |
| go run     | 执行go程序                                           |                                            |
| go install | 类似go build，区别是生成的可执行二进制文件在指定位置 |                                            |
| go get     | 获取网上的 go 包                                     |                                            |
| go doc     | 在线文档                                             | -http :端口号                              |
| go fmt     | 格式化代码                                           |                                            |
| go vet     | 检测代码中的语法错误                                 |                                            |
| go env     | 查看当前go环境                                       | go env -w 变量名=值 可以直接修改go环境变量 |
| go test    | 进行单元测试                                         |                                            |



## go run

### 文件要求

`go run` 后只能跟属于 `main` 包的文件，否则会报错

### 生成特点

`go run`执行后，编译产生的二进制文件存放于一个临时目录中（可以通过 GOTMPDIR查看和设置）

在`go run`结束后，如果没有附加`-work`参数，则会自动清理临时目录中的临时文件

### 参数

| 参数  | 说明                                       |
| ----- | ------------------------------------------ |
| -n    | 查看临时目录路径，不执行编译后的二进制文件 |
| -x    | 查看临时目录路径，执行编译后的二进制文件   |
| -s    | 省略符号表和调试信息                       |
| -w    | 省略DWARF符号表                            |
| -race | 检查并发冲突问题                           |



## go build

### 交叉编译

环境变量含义

| 环境变量    | 含义           | 常用可选值                 |
| ----------- | -------------- | -------------------------- |
| CGO_ENABLED | 是否启用CGO    | 0(禁用) 1(启动)            |
| GOOS        | 目标系统平台   | linux \| windows \| darwin |
| GOARCH      | 目标机器的架构 | amd64 \| arm               |

常用命令

```shell
CGO_ENABLE=0 GOOS=linux GOARCH=amd64 go build -a -o project-name .
```

关于的`GOOS`和`GOARCH`的更多信息可以输入命令`go tool dist list` 来查看

### 压缩二进制文件体积

方式1：丢弃调试信息和符号表信息（不推荐）

| 参数 | 含义              | 副作用                                                      |
| ---- | ----------------- | ----------------------------------------------------------- |
| -w   | 去除DWARF调试信息 | 丢弃调试信息，在发生Panic时，没有堆栈信息，没有文件名和行号 |
| -s   | 去除符号表信息    | 丢弃符号表信息，无法使用gdb调试                             |

```shell
go build -ldflags="-w -s"
```

方式2：使用 upx 工具（推荐）

具体安装和使用，参考：https://github.com/upx/upx

### 注入信息

在编译程序时，可以往程序中注入信息

```shell
go build -ldflgs "-X package_name.variable_name=value"
```



## run/build/install对比

`go run`、`go build` 和 `go install` 的功能类似，都是用于生成二进制文件

`go build` 特点：生成后不执行二进制文件，且生成目录为当前目录

`go install`特点：生成后不执行二进制文件，且生成目录为特定目录（bin目录或$GOBIN）

