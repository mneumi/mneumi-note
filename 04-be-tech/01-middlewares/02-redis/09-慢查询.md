## 慢查询

### 概述

慢查询本质是日志，它记录了一些执行速度很慢的命令

### 慢查询与生命周期

生命周期：慢查询发生在第3阶段

```
 -------                   ------------------------------------------    
|       |   1.发送请求     | redis服务端                              | 
|   客  |  -------------->|              2.排队                      | 
|   户  |                 |   cmd5->cmd4->cmd3->cmd2->cmd1           |
|   端  |    4.返回结果    |                            |             |  
|       | <---------------|                        3.执行命令         |
 -------                   ------------------------------------------
```

### 日志保存形式

* 日志以队列方式存储，队列长度固定，一旦新的慢查询命令过多，最初的慢查询命令会从日志中删除
* 慢查询日志保存在内存中，如果有必要，需要自己进行持久化

### 慢查询两大参数

slowlog-log-slower-than
* 慢查询阈值，单位微秒，大于这个阈值的命令，被判定为慢查询，会加入慢查询日志中
* 这个值=0，记录所有命令；这个值<0，不记录任何命令；默认值：10000

slowlog-max-len
* 慢查询日志队列长度
* 默认值：128

### 设置慢查询参数

通过配置文件

动态配置
* config set slowlog-max-len 1000
* config set slowlog-log-slower-than 1000

### 慢查询命令

可以配合下列命令对慢查询日志进行持久化

| 命令           | 说明                   |
| -------------- | ---------------------- |
| slowlog get[n] | 获取慢查询队列中某个值 |
| slowlog len    | 获取慢查询队列的长度   |
| slowlog reset  | 清空慢查询队列         |