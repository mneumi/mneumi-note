## Bitmap

### 概述

Bitmap译名为位图，其工作原理是用一个bit来标识一个数据

### 使用场景

Bitmap用于海量数据的排序，去重，查询是否存在

### 本质

Bitmap本质是字符串

### 使用

| 命令                         | 功能                                                         | 示例                |
| ---------------------------- | ------------------------------------------------------------ | ------------------- |
| setbit key offset value      | 设置位的值                                                   | setbit unique 0 1   |
| getbit key offset            | 获取位的值                                                   | getbit unique 11    |
| bitcount key [start end]     | 获取指定范围start，end字节中bit为1的个数<br />如果不指定start，end则为全部 | bitcount unique 1 2 |
| bitop and\|or\|xor key1 key2 | 求两个位图的交集，并集，异或                                 | bitop and u1 u2     |

### 实际案例

假设网站有1亿用户， 每天独立访问的用户有5千万，如果每天用集合类型和Bitmap存储活跃用户可以得到表

| 数据类型 | 每个用户id占用空间 | 需要存储的用户量 | 全部内存量             |
| -------- | ------------------ | ---------------- | ---------------------- |
| set      | 64位               | 50000000         | 64位*50000000 = 400MB  |
| bitmap   | 1位                | 100000000        | 1位*100000000 = 12.5MB |

很明显， 这种情况下使用Bitmaps能节省很多的内存空间，尤其是随着时间推移节省的内存还是非常可观的

| 数据类型 | 一天   | 一个月 | 一年  |
| -------- | ------ | ------ | ----- |
| set      | 400MB  | 12GB   | 144GB |
| bitmap   | 12.5MB | 375MB  | 4.5GB |

但Bitmaps并不是万金油， 假如该网站每天的独立访问用户很少， 例如只有10万（大量的僵尸用户），那么两者的对比如下表所示， 很显然这时候使用Bitmaps就不太合适了， 因为基本上大部分位都是0

| 数据类型 | 每个用户id占用空间 | 需要存储的用户量 | 全部内存量             |
| -------- | ------------------ | ---------------- | ---------------------- |
| set      | 64位               | 100000           | 64位*100000 = 800KB    |
| bitmap   | 1位                | 100000000        | 1位*100000000 = 12.5MB |



## HyperLogLog

### 概述

HyperLogLog是基于HyperLogLog算法实现的数据类型

### 使用场景

以极小空间完成数量的统计

### 本质

HyperLogLog的本质是字符串

### 注意事项

* HyperLogLog可能会出现错误，概率为0.81%
* HyperLogLog只能用于统计数目，而不能存储实际的数据

### HyperLogLog的使用

| 命令                             | 说明                 | 示例                   |
| -------------------------------- | -------------------- | ---------------------- |
| pfadd key element1 [element2...] | 添加元素             | pfadd user id1 id2 id3 |
| pfcount key                      | 统计元素             | pfcount user           |
| pfmerge key1 key2                | 合并多个 HyperLogLog | pfmerge user1 user2    |



## GEO

### 概述

Geo记录地理信息的经度和纬度

### 使用场景

计算两地距离，范围等等

### 本质

GEO类型本质使用zset实现

### GEO的使用

| 命令                        | 说明                        |
| --------------------------- | --------------------------- |
| geo key 经度 纬度 地方名    | 添加新的 地方名-经度-纬度   |
| geopos key 地方名           | 查找 地方名对应的经度和纬度 |
| geodist key 地方名1 地方名2 | 计算两个地方名之间的距离    |
| zrem key 地方名             | 删除操作                    |