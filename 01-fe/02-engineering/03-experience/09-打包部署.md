## 开发与生产环境

| 开发环境                        | 生产环境                   |
| ------------------------------- | -------------------------- |
| 带有丰富的调试信息和日志信息    | 尽量消除程序错误和调试信息 |
| 使用本地数据或者mock server数据 | 使用线上真实数据           |
| 为开发调试提供许多的便利功能    | 访问速度很重要             |



## 环境变量

### 概述

| 环境变量     | 值                   |
| ------------ | -------------------- |
| 获取环境变量 | process.env.NODE_ENV |
| 开发环境     | development          |
| 生产环境     | production           |

```js
process.env.NODE_ENV === "development"; // 开发环境
process.env.NODE_ENV === "production";  // 生产环境
```

### 环境变量文件

| 环境变量文件    | 说明     |
| --------------- | -------- |
| .env            | 生产环境 |
| .env.production | 开发环境 |

在开发时，process.env会读取 `.env.development`，打包时，会读取`.env`文件

### 使用示例

```js
axios.defaults.baseURL = process.env.NODE_ENV === "development" ? "http://localhost:8080/api" : "http://apis.mneumi.cn"
```



## 部署

### 部署方式

#### serve

```shell
# 安装
npm install serve -g
yarn global add serve

# 使用
serve -s build # 静态服务文件夹 build
serve -s build -l 12321 # 静态服务文件夹 build，监听 12321
```

#### nginx

```nginx
serve {
    listen 80;
    server_name serverName;
    
    location / {
        root /home/mneumi/build;
        index index.html;
    }
}
```

#### dockerfile

```dockerfile
# 第一个阶段：拉取node镜像来打包项目
FROM node:14 as build
WORKDIR /app
COPY package*.json ./
COPY tsconfig.json ./
COPY public public/
COPY src src/
RUN npm install
RUN npm rum build

# 第二个阶段：创建并运行Nginx服务器，并将打包好的文件复制粘贴到服务器文件夹中
FROM nginx:alpine
COPY --from=build /app/build/ /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", '-g', "daemon off;"]
```

```shell
docker build -t react-web .
```

### 部署shell脚本

```shell
echo "build 生成生产环境代码"
rm -rf dist && npm run build

echo "上传代码到云主机"
cd dist && scp -i ~/.ssh/mneumi.pem -r * user@host:/var/www/project
```

### 部署云平台

| 云平台      | 说明               |
| ----------- | ------------------ |
| Github Page | https://github.com |
| Gitee Page  | https://gitee.com  |
| Vercel      | https://vercel.com |

