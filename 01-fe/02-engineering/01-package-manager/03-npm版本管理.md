## SemVer规范

### SemVer简介

`SemVer`规范是由`Github`起草的，用于统一版本号的表示规则，`npm`中所有的包的版本都需要遵循`SemVer`规范

### 规范说明

`SemVer`规范规定版本号采用 `X.Y.Z` 的格式，其中 X、Y 和 Z 为非负的整数，且禁止在数字前方补零

X 是主版本号、Y 是次版本号、而 Z 为修订号，XYZ 的值都必须是数值形式，且只能递增

| 版本号形式 | 说明                 |
| ---------- | -------------------- |
| 主版本号   | 不兼容的API修改      |
| 次版本号   | 向下兼容的功能性新增 |
| 修订号     | 向下兼容的问题修正   |

例如：`1.0.1 -> 1.13.0 -> 1.13.7`

### 先行版本

当某个版本改动比较大、并非稳定而且可能无法满足预期的兼容性需求时，需要要先发布一个先行版本

先行版本号可以加到`X.Y.Z`的后面，先加上一个连接号再加上一串标识符

| 版本               | 标识符 |
| ------------------ | ------ |
| 内部版本           | alpha  |
| 公测版本           | beta   |
| 正式版本的候选版本 | rc     |

### 发布版本

在修改 `npm` 包某些功能后通常需要发布一个新的版本，通常的做法是直接去修改 `package.json` 到指定版本

但如果操作失误，则很容易造成版本号混乱，所以可以借助符合`Semver` 规范的命令来完成这一操作

| 目的           | 命令              |
| -------------- | ----------------- |
| 升级主版本号   | npm version major |
| 升级次版本号   | npm version minor |
| 升级修订版本号 | npm version patch |



## 依赖版本管理

### 修饰符号

| 修饰符号   | 说明                |
| ---------- | ------------------- |
| ^          | 锁定 X 号，其他最新 |
| ~          | 锁定X和Y，其他最新  |
| 无修饰符号 | 指定版本号          |

例子

| 版本管理        | 说明                      |
| --------------- | ------------------------- |
| "foo": "1.2.3"  | 指定安装版本 1.2.3        |
| "foo": "^1.2.3" | 保证X是 1，Y和Z用最新的   |
| "foo": "~1.2.3" | 保证X是1，Y是2，Z用最新的 |

注意：当主版本号为 `0` 的情况，会被认为是一个不稳定版本

* 主版本号和次版本号都为 `0`: `^0.0.z`、`~0.0.z` 都被当作固定版本，安装依赖时均不会发生变化
* 主版本号为 `0`: `^0.y.z` 表现和 `~0.y.z` 相同，只保持修订号为最新版本

1.0.0 的版本号用于界定公共 API，当你的软件发布到了正式环境，或者有稳定的API时，就可以发布1.0.0版本即决定对外部发布一个正式版本的npm包时，把它的版本标为1.0.0

### 锁定依赖版本

#### lock 文件

使用场景：实际开发中，有时会因为依赖不一致产生奇怪的问题，或者在某些场景下，不希望依赖被更新，则可以在开发中使用 `package-lock.json`文件

前提：使用 package-lock.json 要确保npm的版本在5.6以上

优点

* 锁定依赖版本意味着在不手动执行更新的情况下，每次安装依赖都会安装固定版本，从而保证整个团队使用版本号一致的依赖

* 每次安装固定版本，无需计算依赖版本范围，大部分场景下能大大加速依赖安装时间

#### 定期更新锁定依赖

使用 `npm outdated` 可以帮助我们列出有哪些还没有升级到最新版本的依赖：

- 黄色表示不符合我们指定的语意化版本范围 - 不需要升级
- 红色表示符合指定的语意化版本范围 - 需要升级

执行 `npm update` 会升级所有的红色依赖。

### 最佳实践

对外部发布一个正式版本的npm包时，把它的版本标为`1.0.0`

发布重大版本或版本改动较大时，先发布`alpha、beta、rc`等先行版本

确保`npm`的版本在`5.6`以上，确保默认开启 `package-lock.json` 文件

* 由初始化成员执行 `npm inatall` 后，将 `package-lock.json` 提交到远程仓库
* 定期执行 `npm update` 升级依赖，并提交 `lock` 文件确保其他成员同步更新依赖，不要手动更改 `lock` 文件